<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company List</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* 고정된 컨테이너 스타일 */
        .scrollable-container {
            height: 400px; /* 컨테이너 높이 지정 */
            overflow-y: auto; /* 세로 스크롤 활성화 */
            border: 1px solid #ddd; /* 테두리 추가로 시각적으로 구분 */
            padding: 10px; /* 내부 여백 */
            background-color: #f9f9f9; /* 배경색 */
        }
        .active {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1>Company List</h1>
    <div class="row">
        <div class="col-md-4">
            <div class="scrollable-container">
                <ul id="company-list" class="list-group"></ul>
            </div>
        </div>
        <div class="col-md-4">
            <div class="scrollable-container">
                <ul id="application-list" class="list-group"></ul>
            </div>
        </div>
        <div class="col-md-4">
            <div class="scrollable-container">
                <ul id="product-list" class="list-group"></ul>
            </div>
        </div>
    </div>
</div>

<script>
    async function fetchCompanyNames() {
        try {
            const response = await fetch('http://localhost:8080/api/company');
            const data = await response.json();
            const companyNameList = data.companyNameList;

            const companyListElement = document.getElementById('company-list');
            companyNameList.forEach(companyName => {
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item';
                listItem.textContent = companyName;

                listItem.addEventListener('click', () => {
                    clearLowerLevels('application-list', 'product-list');
                    highlightSelected(listItem, 'company-list');
                    fetchApplications(companyName);
                });

                companyListElement.appendChild(listItem);
            });
        } catch (error) {
            console.error('Error fetching company names:', error);
        }
    }

    async function fetchApplications(companyName) {
        try {
            const response = await fetch(`http://localhost:8080/api/application?companyName=${encodeURIComponent(companyName)}`);
            const data = await response.json();
            const applicationList = data.applicationList;

            const applicationListElement = document.getElementById('application-list');
            applicationListElement.innerHTML = ''; // Clear previous applications
            applicationList.forEach(application => {
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item';
                listItem.innerHTML = `
                    <strong>Contact Person:</strong> ${application.contactPerson}<br>
                    <strong>Email:</strong> ${application.email}<br>
                    <strong>Address:</strong> ${application.address}<br>
                    <strong>Phone Number:</strong> ${application.phoneNumber}<br>
                    <strong>Website:</strong> <a href="${application.website}" target="_blank">${application.website}</a><br>
                    <strong>Comment:</strong> ${application.comment}<br>
                    <strong>Submitting Date:</strong> ${application.submittingDate}
                `;

                listItem.addEventListener('click', () => {
                    clearLowerLevels('product-list');
                    highlightSelected(listItem, 'application-list');
                    fetchProducts(application.applicationId);
                });

                applicationListElement.appendChild(listItem);
            });
        } catch (error) {
            console.error('Error fetching applications:', error);
        }
    }

    async function fetchProducts(applicationId) {
        try {
            const response = await fetch(`http://localhost:8080/api/product?applicationId=${applicationId}`);
            const data = await response.json();
            const productList = data.products;

            const productListElement = document.getElementById('product-list');
            productListElement.innerHTML = ''; // Clear previous products
            productList.forEach(product => {
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item';
                listItem.innerHTML = `
                    <strong>Product Name:</strong> ${product.productName}<br>
                    <strong>Description:</strong> ${product.description}
                `;
                listItem.addEventListener('click', () => {
                    highlightSelected(listItem, 'product-list');
                });
                productListElement.appendChild(listItem);
            });
        } catch (error) {
            console.error('Error fetching products:', error);
        }
    }

    function clearLowerLevels(...elementIds) {
        elementIds.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.innerHTML = ''; // Clear content
            }
        });
    }

    function highlightSelected(selectedElement, listId) {
        const listElement = document.getElementById(listId);
        Array.from(listElement.children).forEach(child => {
            child.classList.remove('active'); // 기존 하이라이트 제거
        });
        selectedElement.classList.add('active'); // 현재 선택 항목 하이라이트 추가
    }

    document.addEventListener('DOMContentLoaded', fetchCompanyNames);
</script>
</body>
</html>
